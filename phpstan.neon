includes:
    - ./vendor/nunomaduro/larastan/extension.neon

parameters:
    level: 8
    paths:
        - src
        - tests
    tmpDir: build/phpstan
    checkOctaneCompatibility: true
    checkModelProperties: true
    treatPhpDocTypesAsCertain: false

    ignoreErrors:
        # Allow dynamic property access on Eloquent models
        - '#Access to an undefined property [a-zA-Z0-9\\_]+::\$[a-zA-Z0-9_]+#'

        # Allow env() in package config files (published to app config)
        -
            identifier: larastan.noEnvCallsOutsideOfConfig
            path: src/Config/*

        # Mockery mock return types in tests
        -
            message: '#should return .+ but returns Mockery\\MockInterface#'
            path: tests/*

        # Mockery fluent expectation API - PHPStan cannot analyze dynamic method chains
        -
            message: '#Call to an undefined method Mockery\\ExpectationInterface\|Mockery\\HigherOrderMessage::#'
            path: tests/*

        # Mockery mock passed to type-hinted constructor parameters
        -
            message: '#expects .+, Mockery\\MockInterface given#'
            path: tests/*

        # Pest expectation template types
        -
            identifier: argument.templateType
            path: tests/*

        # Trivial assertTrue assertions in null object tests
        -
            identifier: method.alreadyNarrowedType
            path: tests/*

        # Generic types cannot be specified in interfaces (implementers use different models)
        -
            identifier: missingType.generics
            path: src/Contracts/*

        # Array value types in interfaces are intentionally flexible
        -
            identifier: missingType.iterableValue
            path: src/Contracts/*

        # Collection covariance - SpatieAdapter implements interface but PHPStan templates aren't covariant
        -
            message: '#should return Illuminate\\Support\\Collection<int, Ordain\\Delegation\\Contracts\\.+Interface> but returns#'
            path: src/Repositories/*

        # Larastan checkModelProperties is too strict for dynamic column names
        -
            identifier: argument.type
            path: src/Repositories/EloquentDelegationRepository.php

        # HasDelegation trait uses dynamic column names not known to PHPStan
        -
            identifier: argument.type
            path: src/Traits/HasDelegation.php

        # HasDelegation trait generic types - trait methods return unspecified generic types
        # because the concrete model type is only known when the trait is used
        -
            identifier: missingType.generics
            path: src/Traits/HasDelegation.php

        # Model $casts property null coalesce - safe fallback pattern
        -
            identifier: nullCoalesce.property
            path: src/Traits/HasDelegation.php

    excludePaths:
        - tests/Pest.php
